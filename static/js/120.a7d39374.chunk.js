(()=>{"use strict";function t(t,o){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=t;const a=t.map((t=>new Date(t).getTime()));let u=null,l=t=>t.toISOString();"auto"===o&&(o=function(t,o){const[n,r]=e(t);let a="hour";r-n>864e5*o&&(a="day");r-n>2592e6*o&&(a="month");r-n>7776e6*o&&(a="quarter");r-n>31536e6*o&&(a="year");return a}(a,n)),"year"===o&&(l=t=>t.getFullYear().toString()),"quarter"===o&&(l=t=>{const e=t.getFullYear().toString(),o=Math.floor(t.getMonth()/3)+1;return"".concat(e,"-Q").concat(o)}),"month"===o&&(l=t=>{const e=t.getFullYear().toString(),o=t.toLocaleString("default",{month:"short"});return"".concat(e,"-").concat(o)}),"day"===o&&(l=t=>{const e=t.getFullYear().toString(),o=t.toLocaleString("default",{month:"short"}),n=t.getDate().toString();return"".concat(e,"-").concat(o,"-").concat(n)}),"hour"===o&&(l=t=>{const e=t.getFullYear().toString(),o=t.toLocaleString("default",{month:"short"}),n=t.getDate().toString(),r=t.getHours();return"".concat(e,"-").concat(o,"-").concat(n," ").concat(r,":00")}),"month_cycle"===o&&(l=t=>new Intl.DateTimeFormat("default",{month:"long"}).format(t),u=[new Date("2000-01-01").getTime(),new Date("2001-01-01").getTime()]),"weekday_cycle"===o&&(l=t=>new Intl.DateTimeFormat("default",{weekday:"long"}).format(t),u=[new Date("2023-11-06").getTime(),new Date("2023-11-13").getTime()]),"hour_cycle"===o&&(l=t=>new Intl.DateTimeFormat("default",{hour:"numeric",hour12:!1}).format(t),u=[new Date("2000-01-01").getTime(),new Date("2000-01-02").getTime()]),r=a.map((t=>l(new Date(t)))),null==u&&(u=e(a));const c=function(t,e,o){const n={},[r,a]=t;let u=0;"year"===e&&(u=314496e5);"quarter"===e&&(u=72576e5);["month","month_cycle"].includes(e)&&(u=24192e5);["day","weekday_cycle"].includes(e)&&(u=864e5);["hour","hour_cycle"].includes(e)&&(u=36e5);if(u>0)for(let l=r;l<=a;l+=u){const t=o(new Date(l));void 0===n[t]&&(n[t]=l)}return n}(u,o,l);return[r,c]}function e(t){let e=t[0],o=t[0];return t.forEach((t=>{t<e&&(e=t),t>o&&(o=t)})),[e,o]}function o(t){return t.split(" ").filter((t=>/\p{L}/giu.test(t)))}function n(t,e){if(".COUNT"===e)return Array(t.body.rows.length).fill("1");const o=t.head.cells.findIndex((t=>t===e));if(o<0)throw new Error("column ".concat(t.id,".").concat(e," not found"));return t.body.rows.map((t=>t.cells[o]))}function r(t){let e;try{e=new URL(t).hostname.replace(/^www\./,"").replace(/^m\./,"")}catch(o){e=t}return e.trim()}async function a(e,o){if(0===e.body.rows.length)return{type:o.type,xKey:"",xLabel:"",yKeys:{},data:[]};const r=function(e,o){const r={},{groupBy:a,xSortable:u}=function(e,o){let r=n(e,o.group.column);if(0===r.length)throw new Error("X column ".concat(e.id,".").concat(o.group.column," not found"));let a=null;void 0!==o.group.dateFormat&&([r,a]=t(r,o.group.dateFormat));if(void 0!==o.group.levels){a={};for(let t=0;t<o.group.levels.length;t++){a[o.group.levels[t]]=t}}return{groupBy:r,xSortable:a}}(e,o),l=e.body.rows.map((t=>t.id)),c=o.group.column,s=o.values.some((t=>!0===t.addZeroes));if(s&&null!=u)for(const[t,n]of Object.entries(u))r[t]={sortBy:n,rowIds:{},xKey:c,xValue:t,values:{}};for(const t of o.values){var i;const s=void 0!==t.aggregate?t.aggregate:"count",g=n(e,t.column);if(0===g.length)throw new Error("Y column ".concat(e.id,".").concat(t.column," not found"));let f=null;void 0!==t.group_by&&(f=n(e,t.group_by).map((e=>"".concat(t.column,".GROUP_BY.").concat(e))));const v=null!==(i=t.addZeroes)&&void 0!==i&&i,y={};for(let e=0;e<l.length;e++){var d;const n=a[e];if(void 0!==o.group.range&&(Number(n)<o.group.range[0]||Number(n)>o.group.range[1]))continue;const i=g[e],v=null!=f?f[e]:t.column,p=null!=u?u[n]:a[e];var m;if(void 0===y[v]&&(y[v]={n:0,sum:0}),"count_pct"!==s&&"mean"!==s||(y[v].n+=1),"pct"===s&&(y[v].sum+=null!==(d=Number(i))&&void 0!==d?d:0),void 0===r[n]&&(r[n]={sortBy:p,rowIds:{},xKey:c,xValue:String(n),values:{}}),void 0===r[n].rowIds[v]&&(r[n].rowIds[v]=[]),r[n].rowIds[v].push(l[e]),void 0===r[n].values[v]&&(r[n].values[v]=0),"count"!==s&&"count_pct"!==s||(r[n].values[v]+=1),"sum"===s||"mean"===s||"pct"===s)r[n].values[v]+=null!==(m=Number(i))&&void 0!==m?m:0}Object.keys(y).forEach((t=>{for(const e of Object.keys(r)){if(void 0===r[e].values[t]){if(!v)continue;r[e].values[t]=0}"mean"===s&&(r[e].values[t]=Number(r[e].values[t])/y[t].n),"count_pct"===s&&(r[e].values[t]=100*Number(r[e].values[t])/y[t].n),"pct"===s&&(r[e].values[t]=100*Number(r[e].values[t])/y[t].sum)}}))}return r}(e,o);return function(t,e,o){const r=function(t,e){const o={};for(const r of e.values){let e="default";if("pct"!==r.aggregate&&"count_pct"!==r.aggregate||(e="percent"),void 0===r.group_by){const t=void 0!==r.label?r.label:r.column;o[r.column]={id:r.column,label:t,tickerFormat:e}}else{const a=Array.from(new Set(n(t,r.group_by)));for(const t of a){const n="".concat(r.column,".GROUP_BY.").concat(t);o[n]={id:n,label:t,tickerFormat:e}}}}return{type:e.type,xKey:e.group.column,xLabel:e.group.label,yKeys:o,data:[]}}(t,e);return r.data=Object.values(o).sort(((t,e)=>t.sortBy<e.sortBy?-1:e.sortBy<t.sortBy?1:0)).map((t=>{for(const e of Object.keys(t.values))t.values[e]=Math.round(100*t.values[e])/100;return{...t.values,[t.xKey]:t.xValue,__rowIds:t.rowIds,__sortBy:t.sortBy}})),r}(e,o,r)}async function u(t,e){const a={type:e.type,topTerms:[]};if(0===t.body.rows.length)return a;const u=n(t,e.textColumn),l=function(t,e,n){const a={};for(let l=0;l<t.length;l++){if(null==(null===t||void 0===t?void 0:t[l]))continue;const c=t[l],s=null!=n.tokenize&&n.tokenize?o(c):[c],i=new Set;for(let t of s){var u;"url_domain"===n.extract&&(t=r(t)),void 0===a[t]&&(a[t]={value:0,docFreq:0}),i.has(t)||(a[t].docFreq+=1,i.add(t));const o=null!=e&&null!==(u=Number(e[l]))&&void 0!==u?u:1;isNaN(o)||(a[t].value+=o)}}return a}(u,null!=e.valueColumn?n(t,e.valueColumn):null,e);return a.topTerms=function(t,e,o){return Object.entries(t).map((t=>{let[o,n]=t;const r=n.value,a=Math.log(e/n.docFreq);return{text:o,value:n.value,importance:r*a}})).sort(((t,e)=>e.importance-t.importance)).slice(0,o)}(l,u.length,200),a}self.onmessage=t=>{(async function(t,e){if(void 0===t||void 0===e)throw new Error("Table and visualization are required");if(["line","bar","area"].includes(e.type))return await a(t,e);if(["wordcloud"].includes(e.type))return await u(t,e);throw new Error("Visualization type ".concat(e.type," not supported"))})(t.data.table,t.data.visualization).then((t=>{self.postMessage({status:"success",visualizationData:t})})).catch((t=>{console.error(t),self.postMessage({status:"error",visualizationData:void 0})}))}})();
//# sourceMappingURL=120.a7d39374.chunk.js.map